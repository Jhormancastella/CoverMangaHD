<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoverManga - Inicio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png " type="image/png">
    <style>
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .slider-section {
            margin-bottom: 50px;
        }

        .slider-container {
            position: relative;
            margin: 20px 0;
        }

        .slider {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .slider::-webkit-scrollbar {
            display: none;
        }

        .slider-item {
            flex: 0 0 auto;
            width: 280px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .slider-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .slider-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .slider-item .info {
            padding: 15px;
        }

        .slider-item h3 {
            margin: 0 0 8px 0;
            font-size: 1.1em;
            color: var(--text-color);
        }

        .slider-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        /* Spinner de carga para carruseles */
        .slider-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            width: 100%;
            text-align: center;
        }

        .slider-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .slider-loading-text {
            color: var(--text-color);
            font-size: 1em;
        }

        /* Indicadores de puntos */
        .slider-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        .slider-dot:hover {
            background: var(--secondary-color);
        }

        /* Navegaci√≥n autom√°tica */
        .slider-nav-auto {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        .auto-nav-btn {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .auto-nav-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .auto-nav-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .no-images-slider {
            text-align: center;
            padding: 40px;
            background: var(--card-bg);
            border-radius: 10px;
            color: #666;
        }

        .category-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
            font-size: 1.1em;
        }

        .category-link:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        /* Modal de Vista Previa */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .preview-modal.active {
            display: flex;
        }

        .preview-content {
            background: white;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            width: 800px;
            position: relative;
            animation: scaleIn 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: var(--card-bg);
        }

        .preview-title {
            margin: 0;
            color: var(--text-color);
            font-size: 1.3em;
        }

        .preview-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .preview-close:hover {
            color: var(--accent-color);
        }

        .preview-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .preview-image-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-image {
            max-width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .preview-info {
            width: 300px;
            padding: 25px;
            background: white;
            border-left: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }

        .preview-details h3 {
            margin: 0 0 15px 0;
            color: var(--text-color);
            font-size: 1.4em;
        }

        .preview-meta {
            margin-bottom: 25px;
        }

        .preview-meta p {
            margin: 8px 0;
            color: #666;
            font-size: 1em;
        }

        .preview-meta strong {
            color: var(--text-color);
        }

        .preview-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: auto;
        }

        .preview-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .preview-btn.download {
            background: var(--primary-color);
            color: white;
        }

        .preview-btn.download:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .preview-btn.view-original {
            background: #8e44ad;
            color: white;
        }

        .preview-btn.view-original:hover {
            background: #9b59b6;
            transform: translateY(-2px);
        }

        .preview-btn.close-preview {
            background: #e74c3c;
            color: white;
        }

        .preview-btn.close-preview:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .preview-navigation {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: var(--card-bg);
            border-top: 1px solid #eee;
        }

        .nav-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--secondary-color);
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .image-counter {
            color: var(--text-color);
            font-weight: 600;
            align-self: center;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2em;
            }
            
            .hero p {
                font-size: 1em;
            }
            
            .slider-item {
                width: 250px;
            }
            
            .slider-indicators {
                flex-wrap: wrap;
            }

            .preview-content {
                flex-direction: column;
                max-width: 95%;
                max-height: 95%;
            }

            .preview-body {
                flex-direction: column;
            }

            .preview-info {
                width: 100%;
                border-left: none;
                border-top: 1px solid #eee;
            }

            .preview-image {
                max-height: 300px;
            }

            .preview-navigation {
                flex-direction: column;
                gap: 10px;
            }

            .nav-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { 
                opacity: 0;
                transform: scale(0.8);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .slider-item {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo" onclick="handleLogoClick()" style="cursor: pointer;">
                <img src="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png " alt="CoverManga" class="logo-img">
                <span>CoverManga</span>
            </div>
            
            <div class="menu-toggle" id="mobile-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Inicio</a></li>
                <li><a href="portadas.html">Portadas</a></li>
                <li><a href="separadores.html">Separadores</a></li>
                <li><a href="cubrepolvos.html">Cubre Polvos</a></li>
                <li><button class="admin-btn" onclick="openAdminModal()">AD</button></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero">
                <h1>Bienvenido a CoverManga</h1>
                <p>Tu galer√≠a definitiva de portadas, separadores y cubre polvos de manga</p>
            </section>

            <!-- Carrusel Portadas -->
            <section class="slider-section">
                <h2 class="section-title">üé¥ Portadas Destacadas</h2>
                <div class="slider-container">
                    <div class="slider" id="portadas-slider">
                        <div class="slider-loading">
                            <div class="slider-spinner"></div>
                            <p class="slider-loading-text">Cargando portadas...</p>
                        </div>
                    </div>
                    <div class="slider-indicators" id="portadas-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('portadas')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="portadas.html" class="category-link">Ver todas las portadas ‚Üí</a>
            </section>

            <!-- Carrusel Separadores -->
            <section class="slider-section">
                <h2 class="section-title">üìë Separadores Populares</h2>
                <div class="slider-container">
                    <div class="slider" id="separadores-slider">
                        <div class="slider-loading">
                            <div class="slider-spinner"></div>
                            <p class="slider-loading-text">Cargando separadores...</p>
                        </div>
                    </div>
                    <div class="slider-indicators" id="separadores-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('separadores')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="separadores.html" class="category-link">Ver todos los separadores ‚Üí</a>
            </section>

            <!-- Carrusel Cubre Polvos -->
            <section class="slider-section">
                <h2 class="section-title">üõ°Ô∏è Cubre Polvos Destacados</h2>
                <div class="slider-container">
                    <div class="slider" id="cubrepolvos-slider">
                        <div class="slider-loading">
                            <div class="slider-spinner"></div>
                            <p class="slider-loading-text">Cargando cubre polvos...</p>
                        </div>
                    </div>
                    <div class="slider-indicators" id="cubrepolvos-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('cubrepolvos')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="cubrepolvos.html" class="category-link">Ver todos los cubre polvos ‚Üí</a>
            </section>
        </div>
    </main>

    <!-- Contador de visitas con banderas -->
    <div style="text-align: center; margin: 30px 0;">
        <a href="https://info.flagcounter.com/qKeN" target="_blank" rel="noopener noreferrer">
            <img src="https://s05.flagcounter.com/count2/qKeN/bg_FFFFFF/txt_000000/border_CCCCCC/columns_8/maxflags_250/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" 
                 alt="Contador de visitantes por pa√≠s" 
                 border="0"
                 style="max-width: 100%; height: auto;">
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Derechos reservados a Jhorman Jes√∫s Castellanos Morales</p>
            <p class="acknowledgments">Agradecimientos especiales a nuestra comunidad de amantes del manga</p>
        </div>
    </footer>

    <!-- Modal Admin -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdminModal()">&times;</span>
            <div id="loginForm" class="login-form">
                <h2>üîê Acceso Administraci√≥n</h2>
                <div class="form-group">
                    <input type="email" id="adminEmail" placeholder="Correo de administrador">
                </div>
                <div class="form-group">
                    <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador">
                </div>
                <button class="submit-btn" onclick="loginAdmin()">Ingresar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Vista Previa -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <div class="preview-header">
                <h3 class="preview-title" id="previewImageTitle">T√≠tulo de la Imagen</h3>
                <button class="preview-close" onclick="closePreviewModal()">&times;</button>
            </div>
            <div class="preview-body">
                <div class="preview-image-container">
                    <img id="previewImage" src="" alt="Vista previa" class="preview-image">
                </div>
                <div class="preview-info">
                    <div class="preview-details">
                        <h3 id="previewDetailTitle">T√≠tulo de la Imagen</h3>
                        <div class="preview-meta">
                            <p><strong>Categor√≠a:</strong> <span id="previewCategory">Portada</span></p>
                            <p><strong>Serie:</strong> <span id="previewSeries">N/A</span></p>
                            <p><strong>Volumen:</strong> <span id="previewVolume">N/A</span></p>
                            <p><strong>Fecha:</strong> <span id="previewDate">N/A</span></p>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="preview-btn download" onclick="downloadPreviewImage()">
                            ‚¨áÔ∏è Descargar Imagen
                        </button>
                        <button class="preview-btn view-original" onclick="viewOriginalImage()">
                            üëÅÔ∏è Ver Original
                        </button>
                        <button class="preview-btn close-preview" onclick="closePreviewModal()">
                            ‚ùå Cerrar Vista Previa
                        </button>
                    </div>
                </div>
            </div>
            <div class="preview-navigation">
                <button class="nav-btn" id="prevBtn" onclick="navigatePreview(-1)">
                    ‚óÄÔ∏è Anterior
                </button>
                <span class="image-counter" id="imageCounter">1 de 10</span>
                <button class="nav-btn" id="nextBtn" onclick="navigatePreview(1)">
                    Siguiente ‚ñ∂Ô∏è
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="security-utils.js"></script>
    <script src="download-utils.js"></script>

    <script>
        // Estado de los carruseles
        const carouselState = {
            portadas: { 
                currentIndex: 0, 
                autoScroll: true, 
                intervalId: null,
                images: [],
                currentCategory: 'portadas'
            },
            separadores: { 
                currentIndex: 0, 
                autoScroll: true, 
                intervalId: null,
                images: [],
                currentCategory: 'separadores'
            },
            cubrepolvos: { 
                currentIndex: 0, 
                autoScroll: true, 
                intervalId: null,
                images: [],
                currentCategory: 'cubrepolvos'
            }
        };

        // Estado del modal de vista previa
        let previewState = {
            currentCategory: null,
            currentIndex: 0,
            images: []
        };

        // Navegaci√≥n m√≥vil
        document.getElementById('mobile-menu').addEventListener('click', function() {
            document.querySelector('.nav-menu').classList.toggle('active');
        });

        // Modal Admin
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
        }

        async function loginAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            try {
                await signInAdmin(email, password);
                window.location.href = 'admin.html';
            } catch (error) {
                console.error('Error de acceso admin:', error);
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        // Funci√≥n para desplazamiento autom√°tico
        function startAutoScroll(category) {
            const state = carouselState[category];
            const slider = document.getElementById(`${category}-slider`);
            const indicators = document.getElementById(`${category}-indicators`);
            
            if (!slider || !indicators) return;

            state.intervalId = setInterval(() => {
                if (!state.autoScroll) return;
                
                const items = slider.querySelectorAll('.slider-item');
                if (items.length === 0) return;

                state.currentIndex = (state.currentIndex + 1) % items.length;
                scrollToItem(category, state.currentIndex);
            }, 4000); // Cambia cada 4 segundos
        }

        // Funci√≥n para desplazarse a un √≠tem espec√≠fico
        function scrollToItem(category, index) {
            const slider = document.getElementById(`${category}-slider`);
            const indicators = document.getElementById(`${category}-indicators`);
            const items = slider.querySelectorAll('.slider-item');
            
            if (items.length === 0) return;

            // Asegurar que el √≠ndice est√© en el rango
            index = (index + items.length) % items.length;
            carouselState[category].currentIndex = index;

            // Desplazar al √≠tem
            const item = items[index];
            const scrollPosition = item.offsetLeft - slider.offsetLeft;
            
            slider.scrollTo({
                left: scrollPosition,
                behavior: 'smooth'
            });

            // Actualizar indicadores
            updateIndicators(category, index);
        }

        // Funci√≥n para actualizar los puntos indicadores
        function updateIndicators(category, activeIndex) {
            const indicators = document.getElementById(`${category}-indicators`);
            const dots = indicators.querySelectorAll('.slider-dot');
            
            dots.forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Funci√≥n para crear indicadores
        function createIndicators(category, count) {
            const indicators = document.getElementById(`${category}-indicators`);
            indicators.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const dot = document.createElement('button');
                dot.className = `slider-dot ${i === 0 ? 'active' : ''}`;
                dot.addEventListener('click', () => {
                    scrollToItem(category, i);
                    // Pausar auto-scroll temporalmente al hacer clic manual
                    pauseAutoScrollTemporarily(category);
                });
                indicators.appendChild(dot);
            }
        }

        // Pausar auto-scroll temporalmente
        function pauseAutoScrollTemporarily(category) {
            const state = carouselState[category];
            state.autoScroll = false;
            
            // Actualizar bot√≥n
            const button = document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`);
            if (button) {
                button.textContent = '‚ñ∂Ô∏è Reanudar';
                button.classList.remove('active');
            }
            
            // Reanudar despu√©s de 10 segundos
            setTimeout(() => {
                if (!state.autoScroll) {
                    state.autoScroll = true;
                    if (button) {
                        button.textContent = '‚è∏Ô∏è Pausar';
                        button.classList.add('active');
                    }
                }
            }, 10000);
        }

        // Alternar auto-scroll
        function toggleAutoScroll(category) {
            const state = carouselState[category];
            const button = document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`);
            
            state.autoScroll = !state.autoScroll;
            
            if (state.autoScroll) {
                button.textContent = '‚è∏Ô∏è Pausar';
                button.classList.add('active');
            } else {
                button.textContent = '‚ñ∂Ô∏è Reanudar';
                button.classList.remove('active');
            }
        }

        // Abrir modal de vista previa
        function openPreviewModal(category, index) {
            const state = carouselState[category];
            if (!state.images || state.images.length === 0) return;

            previewState = {
                currentCategory: category,
                currentIndex: index,
                images: state.images
            };

            updatePreviewModal();
            document.getElementById('previewModal').classList.add('active');
            
            // Pausar auto-scroll de todos los carruseles
            Object.keys(carouselState).forEach(cat => {
                carouselState[cat].autoScroll = false;
                const button = document.querySelector(`[onclick="toggleAutoScroll('${cat}')"]`);
                if (button) {
                    button.textContent = '‚ñ∂Ô∏è Reanudar';
                    button.classList.remove('active');
                }
            });
        }

        // Cerrar modal de vista previa
        function closePreviewModal() {
            document.getElementById('previewModal').classList.remove('active');
            
            // Reanudar auto-scroll de todos los carruseles
            Object.keys(carouselState).forEach(cat => {
                const button = document.querySelector(`[onclick="toggleAutoScroll('${cat}')"]`);
                if (button && button.textContent === '‚ñ∂Ô∏è Reanudar') {
                    carouselState[cat].autoScroll = true;
                    button.textContent = '‚è∏Ô∏è Pausar';
                    button.classList.add('active');
                }
            });
        }

        // Actualizar contenido del modal de vista previa
        function updatePreviewModal() {
            const { currentCategory, currentIndex, images } = previewState;
            const image = images[currentIndex];

            if (!image) return;

            // Actualizar imagen
            document.getElementById('previewImage').src = image.url;
            document.getElementById('previewImage').alt = image.title;

            // Actualizar informaci√≥n
            document.getElementById('previewImageTitle').textContent = image.title;
            document.getElementById('previewDetailTitle').textContent = image.title;
            document.getElementById('previewCategory').textContent = currentCategory;
            document.getElementById('previewSeries').textContent = image.series || 'N/A';
            document.getElementById('previewVolume').textContent = image.volume || 'N/A';
            document.getElementById('previewDate').textContent = image.timestamp?.toDate?.().toLocaleDateString() || 'N/A';

            // Actualizar contador
            document.getElementById('imageCounter').textContent = `${currentIndex + 1} de ${images.length}`;

            // Actualizar estado de botones de navegaci√≥n
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === images.length - 1;
        }

        // Navegar entre im√°genes en el modal
        function navigatePreview(direction) {
            const { currentIndex, images } = previewState;
            const newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < images.length) {
                previewState.currentIndex = newIndex;
                updatePreviewModal();
            }
        }

        // Descargar imagen desde el modal
        async function downloadPreviewImage() {
            const { images, currentIndex } = previewState;
            const image = images[currentIndex];

            if (!image) return;

            try {
                const result = await downloadImageWithFallback(image.url, image.title);
                if (result.method === 'blob') {
                    showNotification('‚úÖ Descarga iniciada', 'success');
                } else {
                    showNotification('‚ÑπÔ∏è Descarga iniciada (modo compatibilidad)', 'info');
                }
            } catch (error) {
                console.error('Error descargando imagen:', error);
                showNotification('‚ùå Error al descargar la imagen', 'error');
            }
        }

        // Ver imagen original
        function viewOriginalImage() {
            const { images, currentIndex } = previewState;
            const image = images[currentIndex];

            if (!image) return;

            window.open(image.url, '_blank', 'noopener,noreferrer');
        }

        // Cargar carruseles
        async function loadSliders() {
            try {
                console.log("üöÄ Cargando carruseles...");

                // Cargar los tres carruseles en paralelo
                await Promise.all([
                    loadCategoryCarousel('portadas'),
                    loadCategoryCarousel('separadores'),
                    loadCategoryCarousel('cubrepolvos')
                ]);

                console.log("‚úÖ Todos los carruseles cargados");

            } catch (error) {
                console.error('‚ùå Error cargando carruseles:', error);
            }
        }

        // Cargar carrusel por categor√≠a
        async function loadCategoryCarousel(category) {
            try {
                console.log(`üìÇ Cargando ${category}...`);
                
                const snapshot = await db.collection('imagenes')
                    .where('category', '==', category)
                    .orderBy('timestamp', 'desc')
                    .limit(10) // M√°ximo 10 im√°genes por carrusel
                    .get();

                const slider = document.getElementById(`${category}-slider`);
                
                if (snapshot.empty) {
                    slider.innerHTML = `
                        <div class="no-images-slider">
                            <h3>No hay ${category} disponibles</h3>
                            <p>Ve al panel de administraci√≥n para subir el primer ${category.slice(0, -1)}</p>
                            <button class="admin-btn" onclick="openAdminModal()" style="margin-top: 10px;">
                                üì§ Subir ${category.slice(0, -1)}
                            </button>
                        </div>
                    `;
                    return;
                }

                slider.innerHTML = '';
                const images = [];
                
                snapshot.forEach(doc => {
                    images.push(sanitizeImageRecord({ id: doc.id, ...doc.data() }));
                });

                // Guardar im√°genes en el estado
                carouselState[category].images = images;

                images.forEach((image, index) => {
                    if (!image.url) return;

                    const slide = document.createElement('div');
                    slide.className = 'slider-item';
                    const img = document.createElement('img');
                    img.src = image.url;
                    img.alt = image.title;
                    img.loading = 'lazy';
                    img.style.opacity = '0';
                    img.style.transition = 'opacity 0.3s ease';
                    img.onload = function() { this.style.opacity = '1'; };
                    img.onerror = function() {
                        this.src = 'https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=Imagen+No+Disponible';
                        this.style.opacity = '1';
                    };

                    const info = document.createElement('div');
                    info.className = 'info';

                    const title = document.createElement('h3');
                    title.textContent = image.title;
                    info.appendChild(title);

                    if (image.series) {
                        const series = document.createElement('p');
                        series.textContent = `üìö ${image.series}`;
                        info.appendChild(series);
                    }

                    if (image.volume) {
                        const volume = document.createElement('p');
                        volume.textContent = `üìñ Vol. ${image.volume}`;
                        info.appendChild(volume);
                    }

                    slide.appendChild(img);
                    slide.appendChild(info);
                    
                    // Hacer la imagen clickeable para abrir vista previa
                    slide.addEventListener('click', () => {
                        openPreviewModal(category, index);
                    });
                    
                    slider.appendChild(slide);
                });

                // Crear indicadores
                createIndicators(category, images.length);
                
                // Iniciar auto-scroll
                startAutoScroll(category);

                console.log(`‚úÖ ${category} cargados:`, images.length);

            } catch (error) {
                console.error(`‚ùå Error cargando ${category}:`, error);
                const slider = document.getElementById(`${category}-slider`);
                const safeMessage = sanitizeText(error.message || 'Error desconocido', 200);
                slider.innerHTML = `
                    <div class="no-images-slider">
                        <h3>Error cargando ${category}</h3>
                        <p>${safeMessage}</p>
                        <button onclick="loadCategoryCarousel('${category}')" style="margin-top: 10px;">
                            üîÑ Reintentar
                        </button>
                    </div>
                `;
            }
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'info') {
            const tempMsg = document.createElement('div');
            const bgColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db';
            
            tempMsg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            tempMsg.textContent = message;
            document.body.appendChild(tempMsg);
            
            setTimeout(() => {
                tempMsg.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(tempMsg)) {
                        document.body.removeChild(tempMsg);
                    }
                }, 300);
            }, 3000);
        }

        // Verificar conexi√≥n a Firebase
        function checkFirebaseConnection() {
            if (!db) {
                console.error('‚ùå Firebase no est√° inicializado');
                return false;
            }
            return true;
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Inicializando p√°gina de inicio...");
            
            if (!checkFirebaseConnection()) {
                ['portadas', 'separadores', 'cubrepolvos'].forEach(category => {
                    document.getElementById(`${category}-slider`).innerHTML = `
                        <div class="no-images-slider">
                            <h3>‚ùå Error de conexi√≥n</h3>
                            <p>No se pudo conectar a la base de datos</p>
                        </div>
                    `;
                });
                return;
            }
            
            // Cargar carruseles iniciales
            loadSliders();
            
            // Pausar auto-scroll cuando el usuario interact√∫e
            ['portadas', 'separadores', 'cubrepolvos'].forEach(category => {
                const slider = document.getElementById(`${category}-slider`);
                if (slider) {
                    slider.addEventListener('mouseenter', () => {
                        carouselState[category].autoScroll = false;
                    });
                    
                    slider.addEventListener('mouseleave', () => {
                        if (document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`).textContent === '‚è∏Ô∏è Pausar') {
                            carouselState[category].autoScroll = true;
                        }
                    });
                }
            });

            // Cerrar modal de vista previa con Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closePreviewModal();
                }
            });
        });

        // Cerrar modal al hacer click fuera
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
            
            const previewModal = document.getElementById('previewModal');
            if (event.target === previewModal) {
                closePreviewModal();
            }
        });

        // Cerrar modal con Escape key
        document.addEventListener('keydown', function(event) {
            if (event.target !== document.getElementById('adminPassword') && event.target !== document.getElementById('adminEmail') && event.key === 'Escape') {
                closeAdminModal();
            }
        });

        // Limpiar intervals cuando la p√°gina se cierre
        window.addEventListener('beforeunload', () => {
            Object.values(carouselState).forEach(state => {
                if (state.intervalId) {
                    clearInterval(state.intervalId);
                }
            });
        });

        // Animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
